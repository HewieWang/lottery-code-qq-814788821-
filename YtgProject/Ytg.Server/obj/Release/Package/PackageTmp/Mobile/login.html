<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head >
    <title>系统登录</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" type="text/css" href="/Content/Css/style.css" />
    <link rel="stylesheet" type="text/css" href="/Content/Css/feile/main.css" />
    <script src="/Content/Scripts/jquery-1.7.min.js" type="text/javascript"></script>
    <!--[if lte IE 6]><script src="Content/Scripts/json2.js"></script><![endif]-->
    <!--[if lte IE 7]><script src="Content/Scripts/json2.js"></script><![endif]-->
    <!--[if IE 8]><script src="/Content/Scripts/json2.js"></script><![endif]-->
    <link href="/Css/login_comm.css" rel="stylesheet" />
    <style>
        .con {
    width: 95%;
    margin: 0 auto;
}
        .right li input {
    width: 90%; 
    height: 32px;
    border: 1px solid #bababa;
    line-height: 32px;
    padding-left: 25px;
    color: #666;
    background: url('/Content/Images/icon.jpg') no-repeat;
    border-radius: 5px;
}
        .right {
    padding-left: 0px;
    width: 90%;
    margin:auto;
   margin:auto;
   float:none;
}
        .right li input {
    width: 100%;
    height: 32px;
    border: 1px solid #bababa;
    line-height: 32px;
    padding-left: 25px;
    color: #666;
    background: url('/Content/Images/icon.jpg') no-repeat;
    border-radius: 5px;
}
        .minghao {
     width: 100%; 
    margin: auto;
    margin-bottom: 10px;
}
        .right li {
    margin-bottom: 10px;
    color: #c1c4c5;
    width: 90%;
}
        .right li input.code {
     width: 100%;
}
        .right .btn {
    color: #fff;
    height: 54px;
    line-height: 54px;
    border: none;
    margin: 0px 0; 
    float:none;
    width: 252px;
    font-size: 16px;
    background: url('/Content/Images/logincomm.png') no-repeat;
}
    </style>
</head>
<body style="background:#bd8f35 url('/Content/Images/Skin/loginbg.jpg');">
    <div id="login_conn"  style="height:50%;margin-top:50px;">
    <div class="minghao" style="text-align:center;"><img src="/Content/Images/minghao.png" alt="美亚娱乐" /></div>
        <div style="height:10px;"></div>
    <div class="con condiv" >  
        
        <div class="right" >
            <h1>用户登录</h1>
            <div id="J-errorBox" class="sl-error sl-error-display"><img src="/Content/Images/error.png" /><span class="sl-error-text"></span></div>
            <div id="loginfst" >
                <p>帐户</p>
            <ul>
                <li><input id="username" name="username" class="user" type="text" placeholder="请输入您的登录账号" /></li>
                <li><p>验证码</p></li>
                <li style="width:100%;border:0px;" cellpadding="0" cellspacing="0">
                    <table style="width:100%;margin:0px;padding:0px;">
                        <tr>
                            <td style="width:80%;"><input id="code" name="code" type="text" placeholder="请输入验证码" class="paw code" style="width:90%;"/></td>
                            <td style="width:20%;"><img width="78" id="codeImg" style="cursor: pointer;height:34px;" /></td>
                        </tr>
                    </table>
                </li>
            </ul>
            <p style="text-align:center;"><input type="button" class="btn" id="nextbtn" value="下 一 步" /></p>
           
           </div>
            <div id="loginlst"  style="display:none;">
            <ul>
                <li >账号</li>
                <li style="padding-left:20px;border-bottom:1px solid #cdd5d9;margin-right:23px;"><p id="cmname" style="color:#000;"></p></li>
                <li >问候语</li>
                <li style="padding-left:20px;border-bottom:1px solid #cdd5d9;margin-right:23px;"><p id="why" style="color:red;">您还没有设置问候语，为了您的安全，请尽快设置！</p></li>
                <li style="color:#666;display:none;" >如果问候语与您预设不一致，则为仿冒！不要输入密码!</li>
                <li>登录密码</li>
                <li><input id="lgpwd" name="lgpwd" class="paw" type="password" placeholder="请输入您的账号密码" /></li>
            </ul>
            <p style="text-align:center;">
                <input type="button" class="btn" id="login_btn" value="登 陆" style="margin:5px;"  />
            </p>
           </div>
            <!--<div style="text-align:right; margin-right:47px;">
                <a href="http://www.mhyule.net/" target="_blank">域名验证</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="/findpassword.html">忘记密码？</a>
            </div>-->
            <div style="clear: both;"></div>
        </div>
         <div style="clear: both;"></div>
    </div>
   </div>
   
  <!--<div id="footer" class="footer_s">
      <div>
           <a href="http://www.google.cn/intl/zh-CN/chrome/browser/desktop/index.html" class="chrome" target="_blank"><img style="width:30px; height:30px;" src="http://cfapu.img48.wal8.com/img48/545266_20160510012323/146281875528.png" alt="谷歌" /></a>
           <a href="https://www.mozilla.org/zh-CN/firefox/new" class="firefox" target="_blank"><img style="width:30px; height:30px;" src="http://cfapu.img48.wal8.com/img48/545266_20160510012323/146281875497.png" alt="火狐" /></a>
           <a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" class="ie" target="_blank"><img style="width:30px; height:30px;" src="http://cfapu.img48.wal8.com/img48/545266_20160510012323/146281875564.png" alt="IE" /></a>
           <a href="http://rj.baidu.com/soft/detail/12966.html?ald" class="ie" target="_blank"><img style="width:30px; height:30px;" src="http://cfapu.img48.wal8.com/img48/545266_20160510012323/146281875463.png" alt="Safari" /></a>
      </div>
      <div>为了更好的操作体验首选Google Chrome、Firefox、IE9或 Safari 浏览器，点击可立即下载。</div>
    </div>-->
</body>
</html>

<script type="text/javascript">
    var isNexting = false;
    var isLogining = false;
    $(function () {
        setCookie("clien_cookie", GetQueryString("form"));
        changeCode();
        $("#footer").css("top", ($(document).height() - 140));
        setCookie("nick_span_updated", "");

    })
    window.onresize = function () {
        $("#footer").css("top", ($(document).height() - 140));
        // $("#login_conn").css("margin-top", (($(window).height() - 500) / 2));
    }
    /**获取url参数*/
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return (r[2]); return null;
    }

    function next() {

        $("#J-errorBox").hide();
        var account = $("#username").val();
        var code = $("#code").val();
        if (account == "" || account.length < 6) {
            $("#J-errorBox").show();
            changeCode();
            $(".sl-error-text").html("账号输入错误");
            return;
        }
        if (code == "" || code.length != 4) {
            $("#J-errorBox").show();
            changeCode();
            $(".sl-error-text").html("验证码输入错误");
            return;
        }
        if (isNexting)
            return;
        isNexting = true;
        $("#nextbtn").val("处理中...");
        $.ajax({
            type: 'POST',
            url: '/Page/Initial.aspx',
            data: "action=getuserwhy&account=" + account + "&code=" + code + "&dt=" + new Date(),
            success: function (data) {
                $("#J-errorBox").hide();
                changeCode();
                isNexting = false;
                $("#nextbtn").val("下一步");
                var jsonData = JSON.parse(data);
                if (jsonData.Code == 0) {
                    //获取成功，

                    $("#why").html(((jsonData.ErrMsg == null || jsonData.ErrMsg == '') ? "您还没有设置问候语，为了您的安全，请尽快设置！" : jsonData.ErrMsg));
                    $("#msg").css("margin-bottom", "0px");
                    $("#loginfst").hide();
                    $("#loginlst").show();
                    $("#cmname").html(account);
                    $("#lgpwd").focus();
                } else if (jsonData.Code == 1004) {//
                    $("#code").select();
                    $("#J-errorBox").show();
                    $(".sl-error-text").html("验证码输入错误");
                } else if (jsonData.Code == 1003) {
                    if (jsonData.ErrMsg != "") {
                        window.location = jsonData.ErrMsg;
                    } else {
                        $("#code").select();
                        $("#J-errorBox").show();
                        $(".sl-error-text").html("账号已禁用，请联系客服处理");
                    }
                } else if (jsonData.Code == 2000) {
                    if (jsonData.ErrMsg != "") {
                        window.location = jsonData.ErrMsg;
                    } else {
                        $("#code").select();
                        $("#J-errorBox").show();
                        $(".sl-error-text").html("IP已锁定，请联系客服处理");
                    }
                } else {//不存在
                    $("#username").select();
                    $("#J-errorBox").show();
                    $(".sl-error-text").html("账号不存在");
                }
            }
        });
    }

    function login() {
        $("#J-errorBox").hide();
        var pwd = $("#lgpwd").val();
        var account = $("#username").val();
        if (pwd == "" || pwd.length < 6) {
            $("#J-errorBox").show();
            $(".sl-error-text").html("密码输入错误");
            return;
        }
        setCookie("message_content", "[]");
        setCookie("line_key", "[]");
        if (isLogining)
            return;
        isLogining = true;
        $("#login_btn").val("正在登陆...");
        $.ajax({
            type: 'POST',
            url: '/Page/Initial.aspx',
            data: "action=login&M_LOGINCODE=" + account + "&M_LOGINVIDACODE=" + code + "&M_LOGINPWD=" + pwd,
            success: function (data) {
                $("#J-errorBox").hide();
                isLogining = false;
                $("#login_btn").val("登陆");
                var jsonData = JSON.parse(data);
                if (jsonData.Code == 0) {
                    //清空聊天cookie

                    //登陆成功，
                    window.location = "/Mobile/LotteryMain.aspx";
                } else if (jsonData.Code == 1003) {
                    $("#code").select();
                    $("#J-errorBox").show();
                    $(".sl-error-text").html("账号已禁用，请联系客服处理");
                } else if (jsonData.Code == 2000) {
                    if (jsonData.ErrMsg != "") {
                        window.location = jsonData.ErrMsg;
                    } else {
                        $("#code").select();
                        $("#J-errorBox").show();
                        $(".sl-error-text").html("IP已锁定，请联系客服处理");
                    }
                } else {//
                    $("#lgpwd").select();
                    $("#J-errorBox").show();
                    $(".sl-error-text").html("账号或密码错误");
                }
            }
        });
    }

    function changeCode() {
        $("#codeImg").attr("src", "/CheckImage.aspx?tp=login&dt=" + new Date());
    }

    $(document).ready(function () {
        $("#nextbtn").click(function () {
            next();
        });
        window.onkeydown = function (key) {
            if (key.keyCode == 13) {
                if ($("#loginfst").css("display") == "block")
                    next();
                else
                    login();
            }
        }
        $("#codeImg").click(function () {
            changeCode();
        });

        $("#login_btn").click(function () {
            login();
        });
    });

    var setCookie = function (name, value, expire, path) {
        var curdate = new Date();
        var cookie = name + "=" + encodeURIComponent(value) + "; ";
        if (expire != undefined || expire == 0) {
            if (expire == -1) {
                expire = 366 * 86400 * 1000;//保存一年
            } else {
                expire = parseInt(expire);
            }
            curdate.setTime(curdate.getTime() + expire);
            cookie += "expires=" + curdate.toUTCString() + "; ";
        }
        path = path || "/";
        cookie += "path=" + path;
        document.cookie = cookie;
    };


</script>
